{% extends 'finance/base.html' %} {% block title %}Metas - Finance
{% endblock %} {% block extra_css %}
<style>
  /* Estilo para barra de progresso */
  .progress-bar-custom {
    transition: width 0.3s ease;
  }
</style>
{% endblock %} {% block content %}
<!-- P√°gina: Lista de Metas -->
<h1 class="page-title mb-4">Metas Mensais</h1>

<!-- ========== BOT√ÉO PARA CRIAR NOVA ========== -->
<div class="row mb-4">
  <div class="col-md-12">
    <a href="{% url 'goal-create' %}" class="btn btn-primary btn-lg">
      Nova Meta
    </a>
  </div>
</div>

<!-- ========== LISTA DE METAS ========== -->
<div class="row">
  {% if metas %}
  <!-- Exibe as metas em um grid -->
  {% for meta in metas %}
  <div class="col-md-6 mb-4">
    <div class="card h-100">
      <div class="card-body">
        <!-- T√≠tulo: M√™s/Ano -->
        <h5 class="card-title">
          {% if meta.month == 1 %}Janeiro 
          {% elif meta.month == 2 %}Fevereiro 
          {% elif meta.month == 3 %}Mar√ßo 
          {% elif meta.month == 4 %}Abril 
          {% elif meta.month == 5 %}Maio 
          {% elif meta.month == 6 %}Junho 
          {% elif meta.month == 7 %}Julho 
          {% elif meta.month == 8 %}Agosto 
          {% elif meta.month == 9 %}Setembro 
          {% elif meta.month == 10 %}Outubro 
          {% elif meta.month == 11 %}Novembro 
          {% elif meta.month == 12 %}Dezembro 
          {%endif %} / {{ meta.year }}
        </h5>

        <!-- Informa√ß√µes -->
        <p class="text-muted mb-3">
          Meta: <strong>R$ {{ meta.total_goal|floatformat:2 }}</strong>
        </p>

        <!-- Progresso -->
        <p class="mb-2">
          Gasto: <strong>R$ {{ meta.gasto_atual|floatformat:2 }}</strong>
        </p>

        <!-- Barra de progresso -->
        <div class="progress mb-3" style="height: 25px">
          <div
            class="progress-bar {% if meta.percentual > 100 %}bg-danger{% elif meta.percentual > 80 %}bg-warning{% else %}bg-success{% endif %} progress-bar-custom"
            role="progressbar"
            data-width="{{ meta.percentual|floatformat:0 }}"
            aria-valuenow="{{ meta.percentual|floatformat:0 }}"
            aria-valuemin="0"
            aria-valuemax="100"
          >
            {{ meta.percentual|floatformat:0 }}%
          </div>
        </div>

        <!-- Status -->
        {% if meta.percentual <= 80 %}
        <span class="badge bg-success mb-3">‚úì Dentro do or√ßamento</span>
        {% elif meta.percentual <= 100 %}
        <span class="badge bg-warning mb-3">‚ö† Aten√ß√£o ao limite</span>
        {% else %}
        <span class="badge bg-danger mb-3">‚úó Acima da meta!</span>
        {% endif %}

        <!-- Bot√µes de a√ß√£o -->
        <div class="d-grid gap-2">
          <!-- Bot√£o: Editar -->
          <a
            href="{% url 'goal-edit' meta.id %}"
            class="btn btn-outline-primary"
          >
            ‚úèÔ∏è Editar
          </a>

          <!-- Bot√£o: Deletar -->
          <a
            href="{% url 'goal-delete' meta.id %}"
            class="btn btn-outline-danger"
          >
            üóëÔ∏è Deletar
          </a>
        </div>
      </div>
    </div>
  </div>
  {% endfor %}
  {% else %}
  <!-- Mensagem quando n√£o h√° metas -->
  <div class="col-md-12">
    <div class="alert alert-info" role="alert">
      <h4 class="alert-heading">üì≠ Nenhuma meta encontrada</h4>
      <p>Crie uma meta para come√ßar a controlar seus gastos!</p>
      <a href="{% url 'goal-create' %}" class="btn btn-primary">
        Criar Primeira Meta
      </a>
    </div>
  </div>
  {% endif %}
</div>
{% endblock %} {% block extra_js %}
<script>
  // Aplicar largura dinamicamente nas barras de progresso
  document.querySelectorAll(".progress-bar-custom").forEach((bar) => {
    const width = bar.getAttribute("data-width");
    bar.style.width = width + "%";
  });
</script>
{% endblock %}
